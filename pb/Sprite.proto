syntax = "proto3";
package m2.pb;

import "m2g_SpriteType.proto";
import "RectI.proto";
import "VecF.proto";
import "Dim2f.proto";
import "M2.proto";

message Color {
  uint32 r = 1;
  uint32 g = 2;
  uint32 b = 3;
  uint32 a = 4;
}

message ImageAdjustment {
  float brightness_multiplier = 1;
}

enum SpriteEffectType {
  __NO_SPRITE_EFFECT = 0; // Shouldn't be used in the code, instead use IsForegroundCompanion{false}
  SPRITE_EFFECT_MASK = 1;
  SPRITE_EFFECT_GRAYSCALE = 2;
  SPRITE_EFFECT_IMAGE_ADJUSTMENT = 3;
}

message SpriteEffect {
  SpriteEffectType type = 1;
  oneof effect_arg {
    Color mask_color = 2;
    ImageAdjustment image_adjustment = 3;
  }
}

message Collider {
  // Vector from origin of the sprite to the position that should be the origin of this collider.
  VecF origin_to_origin_vec_px = 1;

  oneof collider_variant {
    Dim2f rect_dims_px = 11;
    float circ_radius_px = 12;
  }
}

message RegularSprite {
  // List of effects that might be used during the game
  // Effects are only generated for regular sprites, not for sprites with backgrounds.
  // TODO convert to Map
  repeated SpriteEffect effects = 1;

  // Coordinates of the sprite in sheet
  RectI rect = 2;

  // Original rotation should be set according to the rotation of the sprite in the sprite sheet
  // Expects values in-between (-1, 1], which corresponds to -180, 180 degrees.
  // Positive value means the sprite is rotated clockwise in the sheet.
  // Example: If the sprite points towards top-left on the sheet, it's original rotation is -0.75.
  // The graphics system will rotate the sprite back before drawing.
  // Collider parameters should assume the sprite is already rotated.
  float original_rotation = 3;

  // Override the PPm value of the sheet with this value if given.
  int32 override_ppm = 4;

  // Vector from the center of the (rect) to the position that should be the origin
  VecF center_to_origin_vec_px = 5;

  Collider background_collider = 6;
  Collider foreground_collider = 7;

  // If the tile is a background tile, it'll show up in the PAINT list of the level editor.
  bool is_background_tile = 8;

  // Vector from the center of the (rect) to the position that should be the origin of the Foreground Companion
  VecF foreground_companion_center_to_origin_vec_px = 9;
  repeated RectI foreground_companion_rects = 10; // w.r.t SpriteSheet coordinates
}

message Duplicate {
  m2g.pb.SpriteType original_type = 1;
}

message Sprite {
  string comment = 1;
  m2g.pb.SpriteType type = 2;
  oneof variant {
    RegularSprite regular = 3;
    Duplicate duplicate = 4;
  }
}

message SpriteSheet {
  string comment = 1;
  string resource = 2;
  int32 ppm = 3; // Pixels per meter
  repeated Sprite sprites = 4;
}

message SpriteSheets {
  repeated SpriteSheet sheets = 1;
}
